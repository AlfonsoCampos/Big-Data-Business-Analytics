<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>Bucket </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="generator" content="eXeLearning 2.0.1 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript">$exe_i18n={show:"Mostrar",hide:"Ocultar",showFeedback:"Mostrar retroalimentación",hideFeedback:"Ocultar retroalimentación",correct:"Correcto",incorrect:"Incorrecto",menu:"Menú"}</script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="emptyHeader"></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Hive</a></li>
   <li><a href="caractersticas.html" class="no-ch">Características</a></li>
   <li><a href="instalacin.html" class="daddy">Instalación</a>
   <ul class="other-section">
      <li><a href="comprobar_instalacin.html" class="no-ch">Comprobar instalación</a></li>
   </ul>
   </li>
   <li><a href="tipos_de_datos.html" class="no-ch">Tipos de datos</a></li>
   <li><a href="operadores.html" class="no-ch">Operadores</a></li>
   <li><a href="otros_operadores.html" class="no-ch">Otros operadores</a></li>
   <li class="current-page-parent"><a href="estructuras_de_datos.html" class="current-page-parent daddy">Estructuras de datos</a>
   <ul>
      <li><a href="bases_de_datos.html" class="no-ch">Bases de datos</a></li>
      <li><a href="tablas.html" class="no-ch">Tablas</a></li>
      <li><a href="partitioned_tables.html" class="no-ch">Partitioned Tables</a></li>
      <li><a href="external_tables_and_partitioned_tables.html" class="no-ch">External Tables and Partitioned Tables</a></li>
      <li id="active"><a href="bucket.html" class="active no-ch">Bucket</a></li>
      <li><a href="vistas.html" class="no-ch">Vistas</a></li>
      <li><a href="indices.html" class="no-ch">Indices</a></li>
   </ul>
   </li>
   <li><a href="ejemplo_word_count.html" class="no-ch">Ejemplo: word count</a></li>
   <li><a href="ejercicio_1_tipos_de_datos_simples.html" class="no-ch">Ejercicio 1: tipos de datos simples</a></li>
   <li><a href="ejemplo_estructuras_complejas.html" class="no-ch">Ejemplo: estructuras complejas</a></li>
   <li><a href="ejercicio_2_tipos_de_datos_complejos.html" class="no-ch">Ejercicio 2: tipos de datos complejos</a></li>
   <li><a href="otros_comandos_ddl_data_definition_language.html" class="no-ch">Otros comandos DDL (Data Definition Language)</a></li>
   <li><a href="operaciones_dmldata_manipulation_language.html" class="daddy">Operaciones DML(Data Manipulation Language)</a>
   <ul class="other-section">
      <li><a href="load.html" class="no-ch">Load</a></li>
      <li><a href="insert.html" class="no-ch">Insert</a></li>
      <li><a href="update.html" class="no-ch">Update</a></li>
      <li><a href="delete.html" class="no-ch">Delete</a></li>
      <li><a href="exportimport.html" class="no-ch">Export/Import</a></li>
   </ul>
   </li>
   <li><a href="ejemplo_crear_una_tabla_en_hive_y_cargar_un_origen_de_datos.html" class="no-ch">EJEMPLO: Crear una tabla en Hive y cargar un origen de datos</a></li>
   <li><a href="almacenamiento_de_datos.html" class="daddy">Almacenamiento de datos</a>
   <ul class="other-section">
      <li><a href="almacenamiento_en_ficheros.html" class="no-ch">Almacenamiento en ficheros</a></li>
      <li><a href="almacenamiento_en_registros.html" class="no-ch">Almacenamiento en registros</a></li>
      <li><a href="conversin_del_tipo_de_almacenamiento.html" class="no-ch">Conversión del tipo de almacenamiento</a></li>
      <li><a href="compresin.html" class="no-ch">Compresión</a></li>
   </ul>
   </li>
   <li><a href="introduccin_a_sqoop.html" class="daddy">Introducción a Sqoop</a>
   <ul class="other-section">
      <li><a href="import_creacin_de_conexin.html" class="no-ch">Import: creación de conexión</a></li>
      <li><a href="import_definicin_de_datos_a_migrar.html" class="no-ch">Import: definición de datos a migrar</a></li>
      <li><a href="import_cargar_datos_en_hive_y_hbase.html" class="no-ch">Import: cargar datos en Hive y Hbase</a></li>
      <li><a href="importalltables.html" class="no-ch">Import-all-tables</a></li>
      <li><a href="export.html" class="no-ch">Export</a></li>
   </ul>
   </li>
   <li><a href="ejercicio.html" class="no-ch">Ejercicio</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="external_tables_and_partitioned_tables.html" class="prev"><span>&laquo; </span>Anterior</a> | <a href="vistas.html" class="next"> Siguiente<span> &raquo;</span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">Bucket</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id185">
<div class="iDevice emphasis0">
<div id="ta185_1" class="block iDevice_content">
<div class="code panel pdl">
<div class="codeContent panelContent pdl">
<div id="highlighter_203354" class="syntaxhighlighter nogutter  java"><span style="font-size: small; line-height: 1.5; font-family: 'trebuchet ms', geneva;">Las tablas de buckets o clusters permiten obtener registros de muestreo de un modo más eficiente que las tablas que no están clusterizadas ahorrando mucho tiempo en operaciones como las mezclas de datos.  Para ello se emplea el comando CLUSTERED BY o SORTED BY, que no afectan a cómo el dato es almacenado en la tabla, sino a cómo es leído. Por eso es importante que el usuario especifique el número de reductores a emplear al insertar los datos siendo igual al número de buckets.</span></div>
<div class="syntaxhighlighter nogutter  java"> </div>
<div class="syntaxhighlighter nogutter  java">A diferencia de las particiones donde cada valor clave es troceado o particionado en su propio espacio, en un cluster se emplea el hash sobre el valor y después se distribuye en los cubos o buckets. Cada cubo contendrá múltiples elementos, restringuiendo un elemento a un único bucket.</div>
</div>
</div>
<p>Ejemplo de creación de bucket y de carga de datos. </p>
<p>CREATE TABLE user_info_bucketed(user_id BIGINT, firstname STRING, lastname STRING)<br />COMMENT 'A bucketed copy of user_info'<br />PARTITIONED BY(ds STRING)<br />CLUSTERED BY(user_id) INTO 256 BUCKETS;</p>
<p>Una vez creada la tabla, la cargamos de datos. <span style="font-size: 0.75em; line-height: 1.5;"> </span></p>
<p>set hive.enforce.bucketing = true; <br />FROM user_id<br />INSERT OVERWRITE TABLE user_info_bucketed<br />PARTITION (ds='2014-12-31')<br />SELECT userid, firstname, lastname WHERE ds='2014-12-31';</p>
<p>El comando <strong>set hive.enforce.bucketing = true</strong> permite que se seleccione automáticamente el número correcto de reductores y de columnas en el cluster, basándose en la tabla. De otro modo, sería necesario indicar que el número de reductores sea igual al número de buckets mediante la instrucción <strong>set mapred.reduce.tasks = 256;</strong> y a tener la instrucción <strong>CLUSTER BY</strong> en la consulta. </p>
<p>¿Cómo distribuye Hive los datos en los buckets? En general el número de bucktes se determina por la expresión hash_function (bucketing_column) mod num_buckets. La función hash depende del tipo de columna empleada para hacer el bucket. Para un tipo de datos int, se emplea la función hash_int (i) ==i. Por ejemplo si el campo userid fuera un entero y tuviéramos 10 buckets, esperaríamos que todos los userid que terminaran en 0 que estuvieran en el bucket1, todos los que terminan en 1 estuvieran en el bucket 2, etc. Para otros tipos de datos hay un truco. En particular, el hash de un BIGINT no es el mismo BIGINT. Y el hash de un string o de un tipo de datos completo se obtiene del valor, pero no puede ser reconocido por un humano. Siguiendo con el ejemplo, si userid fuera un STRING, el usrid en el bucket1 es probable que no terminara en 0. En general la distribución de filas bassado en hash generarán una distribución impar en los buckets. Para solucionarlo se puede emplear el comando<strong> hive.enforce.bucketing = true</strong> para que las tablas se rellenen correctamente. </p>
</div>
</div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="external_tables_and_partitioned_tables.html" class="prev"><span>&laquo; </span>Anterior</a> | <a href="vistas.html" class="next"> Siguiente<span> &raquo;</span></a>
</div>
</div>
</div>
</body></html>