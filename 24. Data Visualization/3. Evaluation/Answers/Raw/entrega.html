<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>CIFF - Visualización - David García Carbayo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
</head>
<body>
<div class="wrapper container-fluid">
    <div class="row">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">CIFF</a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Highcharts<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="http://www.highcharts.com/" target="_blank">Oficial</a></li>
                                <li><a href="http://www.highcharts.com/stock/demo/grid-light" target="_blank">Doc</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/highcharts/demo1.php">Demo1</a></li>
                                <li><a href="/highcharts/demo2.php">Demo2</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Google<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="https://developers.google.com/chart/" target="_blank">Oficial</a></li>
                                <li><a href="https://developers.google.com/chart/interactive/docs/reference" target="_blank">Doc</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/google/demo1.php">Demo1</a></li>
                                <li><a href="/google/demo2.php">Demo2</a></li>
                                <li><a href="/google/demo3.php">Demo3</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ChartJS<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="http://www.chartjs.org/" target="_blank">Oficial</a></li>
                                <li><a href="http://www.chartjs.org/docs" target="_blank">Doc</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/chartjs/demo1.php">Demo1</a></li>
                                <li><a href="/chartjs/demo2.php">Demo2</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">NVD3<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="http://nvd3.org/" target="_blank">Oficial</a></li>
                                <li><a href="http://nvd3.org/examples/index.html" target="_blank">Doc</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/nvd3/demo1.php">Demo1</a></li>
                                <li><a href="/nvd3/demo2.php">Demo2</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">D3<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="http://d3js.org/" target="_blank">Oficial</a></li>
                                <li><a href="https://github.com/mbostock/d3/wiki" target="_blank">Doc</a></li>
                                <li><a href="http://gcoch.github.io/D3-tutorial/index.html" target="_blank">Manual</a></li>
                                <li><a href="https://github.com/mbostock/d3/wiki/Gallery" target="_blank">Ejemplos</a></li>
                                <li><a href="http://bl.ocks.org/mbostock" target="_blank">Más ejemplos</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="http://tutorials.jenkov.com/svg/index.html" target="_blank">Curso SVG</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/plantilla.html">Plantilla</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/d3/demo1.php">Demo1</a></li>
                                <li><a href="/d3/demo2.php">Demo2</a></li>
                                <li><a href="/d3/demo3.php">Demo3</a></li>
                                <li><a href="/d3/demo4.php">Demo4</a></li>
                                <li><a href="/d3/demo5.php">Demo5</a></li>
                                <li><a href="/d3/demo6.php">Demo6</a></li>
                                <li><a href="/d3/demo7.php">Demo7</a></li>
                                <li><a href="/d3/demo8.php">Demo8</a></li>
                                <li><a href="/d3/demo9.php">Demo9</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tecnologías<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="/angular/">AngularJS</a></li>
                                <li><a href="/d3-angular-2/">Angular2</a></li>
                                <li><a href="/polymer/">Polymer</a></li>
                                <li><a href="/three/">ThreeJS</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Ejercicios<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="/ejercicios/spain">D3 Map</a></li>
                                <li><a href="/ejercicios/barras">Barras</a></li>
                            </ul>
                        </li>
                        <li><a href="/apis">ApiS</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="https://docs.google.com/presentation/d/1uV0hZpneWqO1ewOJ5uqcunbu4Oe_DKzoQU1N_WCzW_U/edit#slide=id.gaf868e374_0_29" target="_blank">Transparencias</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Máster<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="https://docs.google.com/document/d/1Gmz8BjYhdISX1VnTVdYKhvLxovpXf647KrSW_4RSx3o" target="_blank">Programa Intensivo</a></li>
                                <li><a href="https://docs.google.com/document/d/15hl7s8209JfwRu2f3bc5e40Ktan86uzVX2Hi1hnd2wQ" target="_blank">Programa Estándar</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="https://drive.google.com/drive/u/1/folders/0B1ZG_bv_5fptdTdQS3ROYnpra0U" target="_blank">Compartida</a></li>
                                <li><a href="https://plus.google.com/u/1/communities/102222763695151230283" target="_blank">Comunidad</a></li>
                                <li><a href="http://acceso.campusciff.net/?plataforma=bigdataexecutive.campusciff.net" target="_blank">Moodle</a></li>
                                <li><a href="/contacto">Contacto</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="https://github.com/ddgcarbayo/ciff" target="_blank">Repositorio</a></li>
                                <li><a href="/referencias">Referencias</a></li>
                            </ul>
                        </li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
    </div>
    <div class="container-fluid">
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="https://cdn.rawgit.com/rveciana/d3-composite-projections/0.0.3/composite-projections.min.js"></script>
        <script>
            var width = 960,
                    height = 550;
            var colores = {
                "PP": "#03a9e7",
                "PSOE": "#ff2f2e",
                "IU": "#149f27",
                "UPyD": "#d64b8c",
                "CiU": "#024c97",
                "Amaiur": "#b0d2e9",
                "PNV": "#0f7c2f",
                "ERC": "#f9d43f",
                "Compromís": "#faddaa",
                "Podemos": "#82398a",
                "Ciudadanos": "#e28535",
                "Otros": "#e8e8e8"
            };

            var projection = d3.geo.conicConformalSpain()

            var path = d3.geo.path()
                    .projection(projection);

            var svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height);

            var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

            d3.json("https://s3.eu-central-1.amazonaws.com/ciff/provincias.json", function (error, provincias) {
                d3.json("https://s3.eu-central-1.amazonaws.com/ciff/resultados.json", function (error, resultados) {
                    resultados=resultados[0];
                    console.log(resultados);
                    var land = topojson.feature(provincias, provincias.objects.provincias);
                    svg.selectAll("path")
                            .data(land.features)
                            .enter()
                            .append("path")
                            .attr("d", path)
                            .attr("fill", function (d) {
                                try{
                                    var ganador = Object.keys(resultados[d.properties.nombre])[0];
                                    return colores[ganador];
                                }catch(e){
                                    return '';
                                }
                            })
                            .on("mouseover", function (d) {
                                d3.select(this)
                                        .transition()
                                        .style("stroke-width", 4);

                                div.transition()
                                        .duration(200)
                                        .style("opacity", 0.9);
                                var resultados_provincia = "";
                                var partido;
                                for (partido in resultados[d.properties.nombre]) {
                                    resultados_provincia += partido + ": " + resultados[d.properties.nombre][partido] + "</br>";
                                }
                                div.html("Resultados: <br/>" + resultados_provincia)
                                        .style("left", (d3.event.pageX) + "px")
                                        .style("top", (d3.event.pageY - 28) + "px");
                            })
                            .on("mouseout", function (d) {
                                d3.select(this)
                                        .transition()
                                        .style("stroke-width", 0);
                                div.transition()
                                        .duration(500)
                                        .style("opacity", 0);
                            });

                    svg.append("path")
                            .style("fill", "none")
                            .style("stroke", "#000")
                            .attr("d", projection.getCompositionBorders());
                });
            });
        </script>
        <style type="text/css">
            div.tooltip {
                position: absolute;
                text-align: center;
                width: 70px;
                padding: 2px;
                font: 12px sans-serif;
                background: lightsteelblue;
                border: 0px;
                border-radius: 8px;
                pointer-events: none;
            }
        </style>
    </div>
</div>
</body>
</html>
